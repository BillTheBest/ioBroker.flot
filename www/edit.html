<html>
<head>
    <link type="text/css" rel="stylesheet" href="/lib/css/themes/jquery-ui/redmond/jquery-ui.min.css">
    <link type="text/css" rel="stylesheet" href="/lib/css/fancytree/ui.fancytree.min.css"/>


    <script type="text/javascript" src="/lib/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/lib/js/jquery-ui-1.10.3.full.min.js"></script>
    <script type="text/javascript" src="/lib/js/jquery.fancytree-all.min.js"></script>
    <script type="text/javascript" src="/lib/js/translate.js"></script>
    <script type="text/javascript" src="/lib/js/selectID.js"></script>
    <script type="text/javascript" src="/lib/js/socket.io.js"></script>
    <script type="text/javascript" src="lib/js/jqColorPicker.min.js"></script>
    <script type="text/javascript" src="lib/js/jquery-deparam.js"></script>

    <script type="text/javascript" src="/_socket/info.js"></script>
    <script type="text/javascript" src="js/words.js"></script>
    <!--this file must be after translate.js -->

    <style>
        .input {
            width: 150px;
        }

        .label {
            width: 130px;
        }

        .ui-widget input {
            font-size: 14px;
        }

        .header {
            font-weight: bold;
            background: rgba(150, 150, 255, 0.100);
        }

        body {
            font-family: Arial
        }

        h3 {
            line-height: 0.3!important;
            font-size: 15px!important;
        }

        .ui-accordion-content {
            padding: 5px 10px !important;
        }


    </style>
</head>
<body style="height: calc(100% - 16px)">

<div style="height: 250px; position: relative">
    <div id="accordion">
        <h3 id="0">Input data</h3>
        <div>
            <table>
                <tr>
                    <td colspan="2">
                        <button style="margin-left: 1px" id="ids_add">Add new line:</button>
                        <button id="clear" title="Reset settings" class="translateT" style="float: left;">Clear</button>
                    </td>
                    <td>
                    </td>

                </tr>
                <tr>
                    <td colspan="7">
                        <table style="table-layout: fixed;" id="idslist" border="0" cellspacing="0" cellpadding="0"></table>
                    </td>
                </tr>

                <!--<tr>-->
                <!--<td class="translate label">same Day:</td>-->
                <!--<td><input type="checkbox" id="sameDay" class="value input"></td>-->
                <!--</tr>-->
                <!--<tr>-->
                <!--<td class="translate label">same Month:</td>-->
                <!--<td><input type="checkbox" id="sameMonth" class="value input"></td>-->
                <!--</tr>-->
                <!--<tr>-->
                <!--<td class="translate label">same Year:</td>-->
                <!--<td><input type="checkbox" id="sameYear" class="value input"></td>-->
                <!--</tr>-->


            </table>
        </div>
        <h3 id="1">Zeit</h3>
        <div style="display: flex">
            <table >
                <tr>
                    <td class="translate header" colspan="2" style="text-align: center">Time Span</td>
                </tr>
                <tr>
                    <td class="translate">Art:</td>
                    <td><select id="timeArt" class="input option">
                        <option value="relative" class="translate">relative</option>
                        <option value="static" class="translate">static</option>
                    </select></td>
                </tr>
                <tr class="relative">
                    <td class="translate">End:</td>
                    <td><select id="relativeend" class="input option">
                        <option value="now" class="translate">now</option>
                        <option value="today" class="translate">today</option>
                        <option value="month" class="translate">this month</option>
                        <option value="year" class="translate">this year</option>
                    </select></td>
                </tr>
                <tr class="relative">
                    <td class="translate">Range:</td>
                    <td><select id="range" class="option input">
                        <option value="10" class="translate">10 Minutes</option>
                        <option value="30" class="translate">30 Minutes</option>
                        <option value="60" class="translate">1 Hour</option>
                        <option value="120" class="translate">2 Hours</option>
                        <option value="180" class="translate">3 Hours</option>
                        <option value="360" class="translate">6 Hours</option>
                        <option value="720" class="translate">12 Hours</option>
                        <option value="1440" class="translate">1 Day</option>
                        <option value="2880" class="translate">2 Days</option>
                        <option value="4320" class="translate">3 Days</option>
                        <option value="10080" class="translate">7 Days</option>
                        <option value="20160" class="translate">14 Days</option>
                        <option value="43200" class="translate">1 Month</option>
                        <option value="86400" class="translate">2 Months</option>
                        <option value="129600" class="translate">3 Months</option>
                        <option value="259200" class="translate">6 Months</option>
                        <option value="525600" class="translate">1 Year</option>
                        <option value="1051200" class="translate">2 Years</option>
                    </select></td>
                </tr>
                <tr class="relative">
                    <td class="translate">Live:</td>
                    <td><input type="checkbox" class="option" id="live"></td>
                </tr>

                <tr class="static">
                    <td class="translate">Start:</td>
                    <td><input type="date" id="start" class="option input"></td>
                </tr>
                <tr class="static">
                    <td class="translate">End:</td>
                    <td><input type="date" id="end" class="option input"></td>
                </tr>
            </table>
            <table style="margin-left: 25px">
                <tr>
                    <td class="translate header" colspan="2" style="text-align: center">Aggregate</td>
                </tr>
                <tr>
                    <td class="translate ">Schritt Type:</td>
                    <td><select id="aggregateType" class="option input">
                        <option value="step" class="translate">seconds</option>
                        <option value="count" class="translate">counts</option>
                    </select></td>
                </tr>
                <tr>
                    <td class="translate" id="spanName">Schrittweite:</td>
                    <td><input id="aggregateSpan" value="300" class="option input"></td>
                </tr>
                <tr>
                    <td class="translate label">ignore 'null':</td>
                    <td><input type="checkbox" id="getnull" class="option input"></td>
                </tr>
            </table>
        </div>
        <h3 id="2">Options</h3>
        <div style="display: flex">

                <table>
                    <tr>
                        <td class="translate header" colspan="2" style="text-align: center">Appearance</td>
                    <tr>
                        <td class="translate">Width:</td>
                        <td><input id="width" class="option input"></td>
                    </tr>
                    <tr>
                        <td class="translate">Height:</td>
                        <td><input id="height" class="option input"></td>
                    </tr>
                    <tr>
                        <td class="translate">No border:</td>
                        <td><select class="option input" id="noBorder">
                            <option value="" class="translate"></option>
                            <option value="noborder" class="translate">yes</option>
                        </select></td>
                    </tr>
                    <!--<tr>-->
                        <!--<td class="translate label">Predefined background:</td>-->
                        <!--<td><select class="input" id="pre_bg">-->
                            <!--<option value="" class="translate">User defined</option>-->
                            <!--<option value="0">Portrait</option>-->
                            <!--<option value="1">Instagram</option>-->
                            <!--<option value="2">ServQuick</option>-->
                            <!--<option value="3">Metallic Toad</option>-->
                            <!--<option value="4">Clouds</option>-->
                            <!--<option value="5">Mirage</option>-->
                            <!--<option value="6">Steel Gray</option>-->
                            <!--<option value="7">Horizon</option>-->
                            <!--<option value="8">Koko Caramel</option>-->
                            <!--<option value="9">Turquoise flow</option>-->
                        <!--</select></td>-->
                    <!--</tr>-->
                    <tr>
                        <td class="translate label">Background:</td>
                        <td><input type="text" id="bg" class="option input"></td>
                    </tr>
                    </table>


                <table style="margin-left: 25px">
                    <tr>
                        <td class="translate header" colspan="2" style="text-align: center">Title</td>
                    </tr>
                    <tr>
                        <td class="translate">Title:</td>
                        <td><input type="text" id="title" class="option input"></td>
                    </tr>
                    <!-- Do not use values 50, 5, and -5. They are reserved for 50-middle/center, 5-inside at edge, -5 outside at edge -->
                    <tr>
                        <td class="translate">Title position:</td>
                        <td><select class="option input" id="title_pos">
                            <option value="" class="translate">none</option>
                            <option value="top:35;left:65" class="translate">Top, left, inside</option>
                            <option value="top:35;right:5" class="translate">Top, right, inside</option>
                            <option value="top:35;left:50" class="translate">Top, center, inside</option>
                            <option value="top:50;left:65" class="translate">Middle, left, inside</option>
                            <option value="top:50;right:5" class="translate">Middle, right, inside</option>
                            <option value="bottom:5;left:65" class="translate">Bottom, left, inside</option>
                            <option value="bottom:5;right:5" class="translate">Bottom, right, inside</option>
                            <option value="bottom:5;left:50" class="translate">Bottom, center, inside</option>

                            <option value="top:5;right:-5" class="translate">Top, right, outside</option>
                            <option value="top:50;right:-5" class="translate">Middle, right, outside</option>
                            <option value="bottom:5;right:-5" class="translate">Bottom, right, outside</option>
                            <option value="bottom:-5;left:50" class="translate">Bottom, center, outside</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td class="translate">Title color:</td>
                        <td><input type="text" id="titleColor" class="option input"></td>
                    </tr>
                    <tr>
                        <td class="translate">Title size:</td>
                        <td><input type="text" id="titleSize" class="option input"></td>
                    </tr>

                </table>

                <table style="margin-left: 25px">
                    <td class="translate header" colspan="2" style="text-align: center">Options</td>
                    <tr>
                        <td class="translate">Show legend:</td>
                        <td><select class="option input" id="legend">
                            <option value="" class="translate">none</option>
                            <option value="nw" class="translate">Top, left</option>
                            <option value="ne" class="translate">Top, right</option>
                            <option value="sw" class="translate">Bottom, left</option>
                            <option value="se" class="translate">Bottom, right</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td class="translate">Hover details:</td>
                        <td><input type="checkbox" class="option" id="hoverDetail"></td>
                    </tr>
                    <tr>
                        <td class="translate">Time format:</td>
                        <td><select class="option input" id="timeFormat">
                            <option value="" class="translate">Default</option>
                            <option value="%H.%M %d.%m">HH:MM dd.mm</option>
                            <option value="%H.%M <br> %d.%m">HH:MM / dd.mm</option>
                            <option value="%H:%M:%S %d.%m.%y">HH:MM:SS dd.mm.yy</option>
                            <option value="%H:%M %d.%m.%y">HH:MM dd.mm.yy</option>
                            <option value="%I:%M:%S %x %p">HH:MM:SS mm/dd/yy am (US)</option>
                            <option value="%H:%M:%S %d/%m/%y">HH:MM:SS dd/mm/yy (UK)</option>
                            <option value="%H:%M:%S %m.%d.%y">HH:MM:SS mm.dd.yy</option>
                            <option value="%H:%M %m.%d">HH:MM mm.dd</option>
                            <option value="%H:%M:%S">HH:MM:SS</option>
                            <option value="%H:%M">HH:MM</option>
                            <option value="%d.%m.%y">dd.mm.yy</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td class="translate">Smoothing:</td>
                        <td><input type="text" class="option input" id="smoothing"></td>
                    </tr>
                    <tr>
                        <td class="translate">After comma:</td>
                        <td><input type="text" class="option input" id="afterComma"></td>
                    </tr>
                </table>
        </div>
    </div>
</div>
<div style="display: flex;justify-content: space-around;align-items: center;margin-top: 10px;margin-bottom: 10px">
    <label class="translate" for="link">Link</label>
    <textarea id="link" style="width: calc(100% - 130px); height: 55px; word-break: break-all"></textarea>
    <button style="padding-left:0" id="open" class="translateB">Open</button>
</div>
<button id="updatePreview" onclick="updatePreview()" style="width:100%;margin-bottom: 10px">update Preview</button>
<iframe src="index.html" style="width: 100%; bottom: 0; height: calc(100% - 450px)" id="chart"></iframe>
<div id="dialog-select-member" style="display:none"></div>
<script>
    "use strict";

    var systemDictionary = {
        "Input data": {"en": "Input data", "de": "Input data", "ru": "Входные данные"},
//        "Legend and Axes": {"en": "Legend and Axes", "de": "Legend and Axes", "ru": "Легенда и оси"},
//        "Names": {"en": "Names", "de": "Names", "ru": "Имена графиков"},
//        "Colors": {"en": "Colors", "de": "Colors", "ru": "Цвета графиков"},
        "Options": {"en": "Options", "de": "Options", "ru": "Опции"},
//        "Datapoints:": {"en": "Datapoints:", "de": "Datapoints:", "ru": "Данные:"},
        "Range:": {"en": "Range:", "de": "Range:", "ru": "Интервал:"},
        "10 Minutes": {"en": "10 Minutes", "de": "10 Minutes", "ru": "10 Минут"},
        "30 Minutes": {"en": "30 Minutes", "de": "30 Minutes", "ru": "30 Минут"},
        "1 Hour": {"en": "1 Hour", "de": "1 Hour", "ru": "1 час"},
        "2 Hours": {"en": "2 Hours", "de": "2 Hours", "ru": "2 часа"},
        "3 Hours": {"en": "3 Hours", "de": "3 Hours", "ru": "3 часа"},
        "6 Hours": {"en": "6 Hours", "de": "6 Hours", "ru": "6 часов"},
        "12 Hours": {"en": "12 Hours", "de": "12 Hours", "ru": "12 часов"},
        "1 Day": {"en": "1 Day", "de": "1 Day", "ru": "1 день"},
        "2 Days": {"en": "2 Days", "de": "2 Days", "ru": "2 дня"},
        "3 Days": {"en": "3 Days", "de": "3 Days", "ru": "3 дня"},
        "7 Days": {"en": "7 Days", "de": "7 Days", "ru": "7 дней"},
        "14 Days": {"en": "14 Days", "de": "14 Days", "ru": "14 дней"},
        "1 Month": {"en": "1 Month", "de": "1 Month", "ru": "1 месяц"},
        "2 Months": {"en": "2 Months", "de": "2 Months", "ru": "2 месяца"},
        "3 Months": {"en": "3 Months", "de": "3 Months", "ru": "3 месяца"},
        "6 Months": {"en": "6 Months", "de": "6 Months", "ru": "6 месяцев"},
        "1 Year": {"en": "1 Year", "de": "1 Year", "ru": "1 год"},
        "2 Years": {"en": "2 Years", "de": "2 Years", "ru": "2 года"},
        "Width:": {"en": "Width:", "de": "Width:", "ru": "Ширина:"},
        "Height:": {"en": "Height:", "de": "Height:", "ru": "Выстоа:"},
//        "Chart type:": {"en": "Chart type:", "de": "Chart type:", "ru": "Тип графика:"},
        "Line": {"en": "Line", "de": "Linie", "ru": "Линия"},
        "Area": {"en": "Area", "de": "Area", "ru": "Область"},
        "Bar": {"en": "Bar", "de": "Bar", "ru": "Bar"},
        "Line plot": {"en": "Line plot", "de": "Line plot", "ru": "Линия с точками"},
        "Scatter plot": {"en": "Scatter plot", "de": "Scatter plot", "ru": "Точки"},
        "Stack": {"en": "Stack", "de": "Stack", "ru": "Stack"},
//        "Show axis bottom:": {"en": "Show axis bottom:", "de": "Show axis bottom:", "ru": "Показать нижнюю ось:"},
//        "Show axis left:": {"en": "Show axis left:", "de": "Show axis left:", "ru": "Показать ось слева:"},
//        "Show axis right:": {"en": "Show axis right:", "de": "Show axis right:", "ru": "Показать ось справа:"},
        "Show legend:": {"en": "Show legend:", "de": "Show legend:", "ru": "Показать легенду:"},
        "Title:": {"en": "Title:", "de": "Title:", "ru": "Название:"},
        "Title position:": {"en": "Title position:", "de": "Title position:", "ru": "Позиция названия:"},
        "Top, left, inside": {"en": "Top, left, inside", "de": "Top, left, inside", "ru": "Сверху, слева, внутри"},
        "Top, right, inside": {"en": "Top, right, inside", "de": "Top, right, inside", "ru": "Сверху, справа, внутри"},
        "Top, center, inside": {
            "en": "Top, center, inside",
            "de": "Top, center, inside",
            "ru": "Сверху, по центру, внутри"
        },
        "Middle, left, inside": {
            "en": "Middle, left, inside",
            "de": "Middle, left, inside",
            "ru": "Посередине, слева, внутри"
        },
        "Middle, right, inside": {
            "en": "Middle, right, inside",
            "de": "Middle, right, inside",
            "ru": "Посередине, справа, внутри"
        },
        "Bottom, left, inside": {
            "en": "Bottom, left, inside",
            "de": "Bottom, left, inside",
            "ru": "Снизу, слева, внутри"
        },
        "Bottom, right, inside": {
            "en": "Bottom, right, inside",
            "de": "Bottom, right, inside",
            "ru": "Снизу, справа, внутри"
        },
        "Bottom, center, inside": {
            "en": "Bottom, center, inside",
            "de": "Bottom, center, inside",
            "ru": "Снизу, по центру, внутри"
        },
        "Top, right, outside": {
            "en": "Top, right, outside",
            "de": "Top, right, outside",
            "ru": "Сверху, справа, снаружи"
        },
        "Middle, right, outside": {
            "en": "Middle, right, outside",
            "de": "Middle, right, outside",
            "ru": "Посередине, справа, снаружи"
        },
        "Bottom, right, outside": {
            "en": "Bottom, right, outside",
            "de": "Bottom, right, outside",
            "ru": "Снизу, справа, снаружи"
        },
        "Bottom, center, outside": {
            "en": "Bottom, center, outside",
            "de": "Bottom, center, outside",
            "ru": "Снизу, по центру, снаружи"
        },
        "Min:": {"en": "Minimum:", "de": "Minimum:", "ru": "Минимум:"},
        "Max:": {"en": "Maximum:", "de": "Maximum:", "ru": "Максимум:"},
        "User defined names:": {
            "en": "User defined names:",
            "de": "User defined names:",
            "ru": "Задать имена графиков:"
        },
        "Predefined background:": {
            "en": "Predefined background:",
            "de": "Predefined background:",
            "ru": "Выбрать фон:"
        },
        "User defined": {"en": "User defined", "de": "User defined", "ru": "Пользовательские"},
        "Background:": {"en": "Background:", "de": "Background:", "ru": "Фон:"},
//        "Palette:": {"en": "Palette:", "de": "Palette:", "ru": "Палитра:"},
//        "Line thick:": {"en": "Line thick:", "de": "Line thick:", "ru": "Толщина линии:"},
        "Hover details:": {"en": "Hover details:", "de": "Hover details:", "ru": "Показывать подсказку:"},
        "Time format:": {"en": "Time format:", "de": "Time format:", "ru": "Формат времени:"},
        "Default": {"en": "Default", "de": "Default", "ru": "по умолчанию"},
        "Smoothing:": {"en": "Smoothing:", "de": "Smoothing:", "ru": "Сглаживание:"},

//        "default": {"en": "default", "de": "default", "ru": "по умолчанию"},
//        "linear": {"en": "linear", "de": "linear", "ru": "линейная"},
//        "step-after": {"en": "step-after", "de": "step-after", "ru": "step-after"},
//        "cardinal": {"en": "cardinal", "de": "cardinal", "ru": "cardinal"},
//        "basis": {"en": "basis", "de": "basis", "ru": "basis"},
//        "Preview:": {"en": "Preview:", "de": "Preview:", "ru": "Изменение интервала:"},
        "After comma:": {"en": "After comma:", "de": "After comma:", "ru": "Чисел после запятой:"},
        "Open": {"en": "Open", "de": "Open", "ru": "Показать"},
        "Reset settings": {"en": "Reset settings", "de": "Reset settings", "ru": "Сбросить настройки"},
        "Select": {"en": "Select", "de": "Auswählen", "ru": "Выбрать"},
        "Cancel": {"en": "Cancel", "de": "Abbrechen", "ru": "Отмена"},
        "All": {"en": "All", "de": "Alle", "ru": "все"},
        "Name": {"en": "Name", "de": "Name", "ru": "Имя"},
        "Select ID": {"en": "Select ID", "de": "ID Auswählen", "ru": "Выбрать ID"},
        "none": {"en": "none", "de": "nichts", "ru": "ничего"},
        "ID": {"en": "ID", "de": "ID", "ru": "ID"},
        "Role": {"en": "Role", "de": "Rolle", "ru": "Роль"},
        "Room": {"en": "Room", "de": "Raum", "ru": "Комната"},
        "Value": {"en": "Value", "de": "Wert", "ru": "Значение"},
//        "Type": {"en": "Type", "de": "Typ", "ru": "Тип"},
        "From": {"en": "From: ", "de": "Von", "ru": "От"},
        "Last changed": {"en": "Last changed", "de": "Lätze Änderung", "ru": "Изменён"},
        "Time stamp": {"en": "Time stamp", "de": "Zeitstempel", "ru": "Время"},
        "Acknowledged": {"en": "Acknowledged", "de": "Bestätigt", "ru": "Подтверждён"},
//        "common": {"en": "common", "de": "allgemein", "ru": "Общие параметры"},
//        "native": {"en": "native", "de": "nativ", "ru": "Уникальные параметры"},
//        "rest": {
//            "en": "rest (read only)",
//            "de": "weitere (nur lesend)",
//            "ru": "Остальные параметры(только для чтения)"
//        },
        "Edit": {"en": "Edit", "de": "Editieren", "ru": "Edit"},
        "Members": {"en": "Members", "de": "Mitglied", "ru": "Объекты"},
        "Loading...": {"en": "Loading...", "de": "Lade...", "ru": "Загрузка..."},
        "Processing...": {"en": "Processing...", "de": "Bearbeite...", "ru": "Обработка..."},
        "With lines": {"en": "With lines", "de": "With lines", "ru": "С линиями"},
        "Without lines": {"en": "Without lines", "de": "Without lines", "ru": "Без линий"},
        "Inside / With lines": {"en": "Inside / With lines", "de": "Inside / With lines", "ru": "Внутри / С линиями"},
        "Outside/ With lines": {"en": "Outside/ With lines", "de": "Outside/ With lines", "ru": "Снаружи/ С линиями"},
        "Inside / No lines": {"en": "Inside / No lines", "de": "Inside / No lines", "ru": "Внутри / Без линий"},
        "Outside / No lines": {"en": "Outside / No lines", "de": "Outside / No lines", "ru": "Снаружи / Без линий"},
        "Interpolate:": {"en": "Interpolate:", "de": "Interpolieren:", "ru": "Интерполяция:"},
        "Steps": {"en": "Steps", "de": "Schritte", "ru": "Ступени"},
        "Pie": {"en": "Pie", "de": "Kuchen", "ru": "Круговая диаграмма"},
        "Top, left": {"en": "Top, left", "de": "Oben, links", "ru": "Сверху, слева"},
        "Top, right": {"en": "Top, right", "de": "Oben, rechts", "ru": "Сверху, справа"},
        "Bottom, left": {"en": "Bottom, left", "de": "Unten, links", "ru": "Снизу, слева"},
        "Bottom, right": {"en": "Bottom, right", "de": "Unten, rechts", "ru": "Снизу, справа"},
        "Title color:": {"en": "Title color:", "de": "Titelfarbe:", "ru": "Цвет названия:"},
        "Title size:": {"en": "Title size:", "de": "Titelgröße:", "ru": "Размер названия:"},
        "Fill range:": {"en": "Fill range:", "de": "Ganzer Bereich:", "ru": "Всегда весь интервал:"},
        "Units:": {"en": "Units:", "de": "Einheiten:", "ru": "Единицы:"},
        "yes": {"en": "yes", "de": "ja", "ru": "да"},
        "bottom": {"en": "bottom", "de": "unten", "ru": "снизу"},
        "top": {"en": "top", "de": "oben", "ru": "сверху"},
        "left": {"en": "left", "de": "links", "ru": "слева"},
        "right": {"en": "right", "de": "rechts", "ru": "справа"},
        "No border:": {"en": "No border:", "de": "Kein Rahmen:", "ru": "Без рамки:"},

        "Zeit": {"en": "Zeit", "de": "Zeit", "ru": "Zeit"},
        "Range Typ:": {"en": "Range Typ:", "de": "Range Typ:", "ru": "Range Typ:"},
        "Day": {"en": "Day", "de": "Day", "ru": "Day"},
        "Month": {"en": "Month", "de": "Month", "ru": "Month"},
        "Year": {"en": "Year", "de": "Year", "ru": "Year"},
        "Individual": {"en": "Individual", "de": "Individual", "ru": "Individual"},
        "Art:": {"en": "Art:", "de": "Art:", "ru": "Art:"},
        "relative": {"en": "relative", "de": "relative", "ru": "relative"},
        "static": {"en": "static", "de": "static", "ru": "static"},
        "now": {"en": "now", "de": "now", "ru": "now"},
        "today": {"en": "today", "de": "today", "ru": "today"},
        "this month": {"en": "this month", "de": "this month", "ru": "this month"},
        "this year": {"en": "this year", "de": "this year", "ru": "this year"},
        "Start:": {"en": "Start:", "de": "Start:", "ru": "Start:"},
        "End:": {"en": "End:", "de": "End:", "ru": "End:"},
        "Aggregate": {"en": "Aggregate", "de": "Aggregate", "ru": "Aggregate"},
        "Schritt Type:": {"en": "Schritt Type:", "de": "Schritt Type:", "ru": "Schritt Type:"},
        "seconds": {"en": "seconds", "de": "seconds", "ru": "seconds"},
        "Schrittweite:": {"en": "Schrittweite:", "de": "Schrittweite:", "ru": "Schrittweite:"},
        "Link": {"en": "Link", "de": "Link", "ru": "Link"},
        "Counts": {"en": "Counts", "de": "Counts", "ru": "Counts"},
        "ignore 'null':": {"en": "ignore 'null':", "de": "ignore 'null':", "ru": "ignore 'null':"},

        "Time Span": {"en": "Time Span", "de": "Zeit Spanne", "ru": "Time Span"},
        "Appearance": {"en": "Appearance", "de": "Erscheinung", "ru": "Appearance"},
        "Title": {"en": "Title", "de": "Title", "ru": "Title"},
        "Offset": {"en": "Offset", "de": "Offset", "ru": "Offset"},
        "Art": {"en": "Art", "de": "Art", "ru": "Art"},
        "Chart Type": {"en": "Chart Type", "de": "Chart Type", "ru": "Chart Type"},
        "Color": {"en": "Color", "de": "Color", "ru": "Color"},
        "Min": {"en": "Min", "de": "Min", "ru": "Min"},
        "Max": {"en": "Max", "de": "Max", "ru": "Max"},
        "Unit": {"en": "Unit", "de": "Unit", "ru": "Unit"},
        "Y Axe": {"en": "Y Axe", "de": "Y Axe", "ru": "Y Axe"},
        "X Axe": {"en": "X Axe", "de": "X Axe", "ru": "X Axe"},

    };


    var defaultColors = ["#FF0000", "#00FF00", "#0000FF", "#FFFF00", "#FF00FF", "#00FFFF", "#800000", "#008000", "#000080", "#808000", "#800080", "#008080"]


    var objects = {};;
    var states = {};
    var timer = null;
    var setup = {
        options: {
            lines: [
                {
                    id: "",
                    offset: 0,
                    art: "average",
                    color: "#FF0000",
                    min: "",
                    max: "",
                    thickness: 3,
                    unit: "",
                    name: ""
                }
            ]
        }
    };


        if (typeof sysLang !== undefined) systemLang = sysLang || 'en';
        $('#dialog-select-member').selectId('init', {
            filter: {
                common: {
                    history: {
                        enabled: true
                    }
                }
            },
            noMultiselect: true,
            connCfg: {
                socketUrl: socketUrl,
                socketSession: socketSession,
                socketName: 'rickshawEdit'
            },
            columns: ['name', 'role', 'room', 'value'],
            texts: {
                select: _('Select'),
                cancel: _('Cancel'),
                all: _('All'),
                id: _('ID'),
                name: _('Name'),
                role: _('Role'),
                room: _('Room'),
                value: _('Value'),
                selectid: _('Select ID'),
                from: _('From'),
                lc: _('Last changed'),
                ts: _('Time stamp'),
                wait: _('Processing...'),
                ack: _('Acknowledged')
            }
        });



    function showIds(callback) {
        setTimeout(function () {
            var text = '<tr style="text-align: center">' +
                    '<td></td>' +
                    '<td >'+_('ID')+'</td>' +
                    '<td ></td>' +
                    '<td >'+_('Offset')+'</td>' +
                    '<td >'+_('Art')+'</td>' +
                    '<td >'+_('Chart Type')+'</td>' +
                    '<td >'+_('Color')+'</td>' +
                    '<td >'+_('Min')+'</td>' +
                    '<td >'+_('Max')+'</td>' +
                    '<td >'+_('Unit')+'</td>' +
                    '<td >'+_('Y Axe')+'</td>' +
                    '<td >'+_('X Axe')+'</td>' +
                    '<td >&#216</td>' +
                    '<td >'+_('Name')+'</td></tr>';

            for (var i= 0; i < setup.options.lines.length; i++) {
                var index = setup.options.lines[i]

                text += '<tr id="inputData' + i + '" class="inputData">' +
                        '<td class="label" style="width: 60px; min-width: 60px">' + _('Line') + ' ' + (i + 1) + '</td>' +
                        '<td style="padding-left: 4px; display:"><input data-option="id" class="input inputData_id idsnames options_lines" style="display: inline; width: 200px" value="' + index.id + '"></td><td><button style="display: inline" class="select-dialog" data-ids="' + i + '">...</button></td>' +
                        '<td style="padding-left:5px">' +
                        '<select class="input inputData_offset options_lines" style="width: 70px"  data-option="offset"> ' +
                            '<option value="0" class="translate">0s</option> ' +
                            '<option value="10" class="translate">10s</option>' +
                            '<option value="30" class="translate">30s</option>' +
                            '<option value="60" class="translate">60s</option>' +
                            '<option value="120" class="translate">2m</option>' +
                            '<option value="180" class="translate">3m</option>' +
                            '<option value="240" class="translate">4m</option>' +
                            '<option value="300" class="translate">5m</option>' +
                            '<option value="600" class="translate">10m</option>' +
                            '<option value="900" class="translate">15m</option>' +
                            '<option value="1800" class="translate">30m</option>' +
                            '<option value="2700" class="translate">45m</option>' +
                            '<option value="3600" class="translate">1S</option>' +
                            '<option value="7200" class="translate">2S</option>' +
                            '<option value="21600" class="translate">6S</option>' +
                            '<option value="43200" class="translate">12S</option>' +
                            '<option value="86400" class="translate">1T</option>' +
                            '<option value="172800" class="translate">2T</option>' +
                            '<option value="259200" class="translate">3T</option>' +
                            '<option value="345600" class="translate">4T</option>' +
                            '<option value="604800" class="translate">1W</option>' +
                            '<option value="1209600" class="translate">2W</option>' +
                            '<option value="2419200" class="translate">4W</option>' +
                            '<option value="30758400" class="translate">1J</option>' +
                            '<option value="61516800" class="translate">2J</option>' +
                        '</select></td>' +
                        '<td style="padding-left:5px">' +
                        '<select style="width: 90px" data-option="art" class="input inputData_art options_lines">' +
                            '<option value="average" class="translate">average</option>' +
                            '<option value="max" class="translate">max</option>' +
                            '<option value="min" class="translate">min</option>' +
                            '<option value="total" class="translate">total</option>' +
                        '</select>' +
                        '</td>' +
                        '<td><select style="width: 120px" data-option="chartType" class="input options_lines">'+
                            '<option value="line" class="translate">Line</option>'+
                            '<option value="area" class="translate">Area</option>'+
                            '<!--<option value="bar" class="translate">Bar</option>-->'+
                            '<option value="lineplot" class="translate">Line plot</option>'+
                            '<option value="scatterplot" class="translate">Scatter plot</option>'+
                            '<option value="steps" class="translate">Steps</option>'+
                            '<!--<option value="pie" class="translate">Pie</option>-->'+
                        '</select></td>'+
                        '<td style="padding-left:5px"><input data-option="color"  style="width:  70px"  class="inputData_color options_lines" value="' + index.color + '"></td>' +
                        '<td style="padding-left:5px"><input data-option="min"  style="width:  70px"  class="inputData_min   options_lines"   value="' + index.min + '"></td>' +
                        '<td style="padding-left:5px"><input data-option="max"  style="width:  70px"  class="inputData_max   options_lines"   value="' + index.max + '"></td>' +
                        '<td style="padding-left:5px"><input data-option="unit"  style="width:  70px"  class="inputData_unit  options_lines"  value="' + index.unit + '"></td>' +
                        '<td style="padding-left:5px">' +
                        '<select style="width:  140px" data-option="yaxe" class="input options_lines">' +
                            '<option value="off" class="translate">off</option>' +
                            '<option value="left" class="translate">left</option>' +
                            '<option value="right" class="translate">right</option>' +
                            '<option value="leftColor" class="translate">left colored</option>' +
                            '<option value="rightColor" class="translate">right colored</option>' +
                        '</select></td>' +
                        '<td style="padding-left:5px">' +
                        '<select style="width:  140px" data-option="xaxe" class="input options_lines">' +
                            '<option value="off" class="translate">off</option>' +
                            '<option value="top" class="translate">top</option>' +
                            '<option value="bottom" class="translate">bottom</option>' +
                            '<option value="topColor" class="translate">top colored</option>' +
                            '<option value="bottomColor" class="translate">bottom colored</option>' +
                        '</select></td>' +
                        '<td style="padding-left:5px"><input data-option="thickness" class="inputData_thickness options_lines"  style="width: 30px"   value="' + index.thickness + '"></td>' +
                        '<td style="padding-left:5px"><input data-option="name" class="inputData_name options_lines"       style="width: 200px"  value="' + index.name + '"></td>' +
                        '<td style="padding-left:5px"><button class="idRemove"></button></td>' +
                        '</tr>'

            }

            $('#idslist').html(text);

//            $('.idsnames').change(function () {
//                var id = $(this).attr('id').substring('ids_'.length);
//                ids[id] = $(this).val();
//                update();
//            }).keyup(function () {
//                $(this).trigger('change');
//            });

            $('.inputData_color').colorPicker({
                renderCallback: function ($elm, toggled) {
                    if (toggled === false) {
                        $elm.trigger("change")
                    }
                }
            })


            $('.idRemove').button({
                icons: {primary: 'ui-icon-trash'},
                text: false
            }).click(function () {
                if (setup.options.lines.length > 1) {
                    var i = parseInt($(this).parent().parent().attr("id").replace("inputData", ""));
                    setup.options.lines.splice(i, 1)
                    showIds()
                }
            }).css({width: 22, height: 22});


            $('.select-dialog').button({
                text: false,
                icons: {
                    primary: 'ui-icon-folder-open'
                }
            }).css({width: 25, height: 22}).click(function () {
                var index = $(this).parent().parent().attr('id').replace('inputData', '');
                $('#dialog-select-member').selectId('show', setup.options.lines[index]['id'], undefined, function (newId) {
                    setup.options.lines[index]['id'] = newId;
                    showIds()
                });

            });

            $('.options_lines').each(function () {
                var $this = $(this);
                var index = $(this).parent().parent().attr('id').replace('inputData','');
                var opt = $(this).data('option')
                if (setup.options.lines[index][opt] !== undefined) {
                    if ($this.attr('type') == 'checkbox') {
                        $this.prop('checked', !!setup.options.lines[index][opt]);
                    } else {
                        $this.val(setup.options.lines[index][opt]);
                    }
                }
            })

            if (typeof callback == 'function') callback();
//            update()
        }, 100);
    }

    function getSettings() {
//        var config = {
//            //colors:   ["#c05020", "#30c020", "#6060c0"],
//            //names:    ["Temperature", "Humidity", "Airpressure"],
//        };
//        $('.value').each(function (index) {
//            if ($(this).attr('type') == 'checkbox') {
//                config[$(this).attr('id')] = $(this).prop('checked');
//            } else {
//                config[$(this).attr('id')] = encodeURI($(this).val());
//            }
//        });
//        config._ids = encodeURI(ids.join(';'));
//        config._offsets = encodeURI(offsets.join(';'));
//        config._arts = encodeURI(arts.join(';'));
//        config._colors = encodeURI(colors.join(';'));
////        config._names = encodeURI(names.join(';'));
//
//        var config =  jQuery.param(setup.options)
//console.log()
//        var text = '';
//        for (var opt in config) {
//            if (config[opt]) text += (text ? '&' : '') + opt + '=' + config[opt];
//
//        }
//
//        var x = decodeURIComponent(jQuery.param(setup.options);
//        console.log()


        var _options = JSON.parse(JSON.stringify(setup.options));

        // clean options
        for (var x in _options){
            if(_options[x] == ""){
                delete _options[x]
            }
        }


        // clean linse
        for (var i=0; i < _options.lines.length; i++) {
            if (_options.lines[i].id == ""){
                _options.lines.splice(i,1)
                i--
            }else{
                for (var x in _options.lines[i]) {
                    if (_options.lines[i][x] == "") {
                        delete _options.lines[i][x]
                    }
                }
            }


        }

        var params = $.param(_options);
        console.log(deparam(params))
        return  params
    }

    function delayedUpdate() {
        if (timer) {
            clearTimeout(timer);
            timer = null;
        }
        timer = setTimeout(update, 500);
    }

    function update() {
        clearTimeout(timer);
        timer = null;
        var settings = getSettings();
        $('#link').val(location.href.replace('edit.html', 'index.html') + '?' + settings);
        $('#updatePreview').button("option", "disabled", false).click(function(){

        });
        // Store settings
        if (typeof(Storage) !== "undefined") {

            $('.value').each(function (index) {
                if ($(this).attr('type') == 'checkbox') {
                    setup[$(this).attr('id')] = $(this).prop('checked');
                } else {
                    setup[$(this).attr('id')] = $(this).val();
                }
            });
            $('.option').each(function (index) {
                if ($(this).attr('type') == 'checkbox') {
                    setup.options[$(this).attr('id')] = $(this).prop('checked');
                } else {
                    setup.options[$(this).attr('id')] = $(this).val();
                }
            });

            save()
        }

        if ($('#aggregateType').val() == "step") {
            $('#spanName').text(_("Seconds") + ":")
        } else {
            $('#spanName').text(_("Counts") + ":")
        }
        $('.relative, .static').hide()
        $('.' + $('#timeArt').val()).show()
    }

    function save(){
        localStorage.setItem("iobroker.Flot", JSON.stringify(setup));
    }

    function updatePreview() {
        $('#chart').css({height: (parseInt($('#height').val()) || 500) + 90});
        var settings = getSettings();
        $('#chart').attr('src', '');
        setTimeout(function () {
            $('#chart').attr('src', 'index.html?' + settings + '&' + (new Date()).getTime());
        }, 0)

//        $('#updatePreview').button("option", "disabled", true);
    }


    $(document).ready(function() {

        if (typeof(Storage) !== "undefined") {
            var _setup = localStorage.getItem("iobroker.Flot");
            try {
                _setup = JSON.parse(_setup);
                if (_setup.options){
                    setup = _setup
                }
            }
            catch (e) {
                console.log('Cannot parse stored settings');
            }
        }

        $("#accordion").accordion({
            active : parseInt(setup.acc) || 0,
            heightStyle: "fill",
            animate: {
                easing: "linear",
                duration: 200
            },
            activate: function( event, ui ) {
                setup['acc'] = $(ui.newHeader).attr('id');
                save();
            }

        });


        showIds();

        $("#accordion").on('change', '.options_lines', function(){
            var index = parseInt($(this).parent().parent().attr('id').replace('inputData',''));
            setup.options.lines[index][$(this).data('option')] = $(this).val()
            update()
        })


        $('.value').each(function () {
            var $this = $(this);
            var id = $this.attr('id');
            if (setup[id] !== undefined) {
                if ($this.attr('type') == 'checkbox') {
                    $this.prop('checked', !!setup[id]);
                } else {
                    $this.val(setup[id]);
                }
            }
        })

        $('.option').each(function () {
            var $this = $(this);
            var id = $this.attr('id');
            if (setup.options[id] !== undefined) {
                if ($this.attr('type') == 'checkbox') {
                    $this.prop('checked', !!setup.options[id]);
                } else {
                    $this.val(setup.options[id]);
                }
            }
        })

        $('#ids_add').button({
            icons: {secondary: 'ui-icon-plus'},
            text: true
        }).click(function () {

            var index = setup.options.lines.length
            setup.options.lines.push({
                id: "",
                offset: 0,
                art: "average",
                color: defaultColors[index] || "#00FFFF",
                min: "",
                max: "",
                thickness: 3,
                unit: "",
                name: ""
            })
            showIds()
        }).css({width: 165, height: 30});

        $('#clear').button({
            icons: {primary: 'ui-icon-trash'},
            text: false
        }).click(function () {
            localStorage.setItem("iobroker.Flot", JSON.stringify({reset: true}));
            location.reload();
        }).css({width: 30, height: 30});



        $('.value').change(update).keyup(function () {
            $(this).trigger('change');
        });
        $('.option').change(update).keyup(function () {
            $(this).trigger('change');
        });

        $('#timeArt').change(function () {
            $('.relative, .static').hide()
            $('.' + $(this).val()).show()
        })

        $('#width').spinner().on('spin', delayedUpdate).parent().addClass('input');
        $('#height').spinner().on('spin', delayedUpdate).parent().addClass('input');
        $('#smoothing').spinner().on('spin', delayedUpdate).parent().addClass('input');
        $('#strokeWidth').spinner().on('spin', delayedUpdate).parent().addClass('input');
        $('#afterComma').spinner().on('spin', delayedUpdate).parent().addClass('input');


        $('#aggregateType').change(function () {

            if ($('#aggregateType').val() == "step") {
                $('#spanName').text(_("Seconds"))
            } else {
                $('#spanName').text(_("Counts"))
            }
        });


//    $('#range').val(options.range);
//    $('#axeX').val(options.axeX);
        $('#updatePreview').button();
        $('#open').button().click(function () {
            window.open($('#link').val());
        });




            translateAll();

    update();



        // Handler for .ready() called.
    });

</script>
</body>
</html>